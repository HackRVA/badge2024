
This README describes tools in this folder.

# png-to-badge-asset

This utility is a C program that converts png files to the new badge
asset format "struct asset2", for use with FbImage2(), FbImage8bit2(),
etc.

You can build it via:

```
	$ cd tools
	$ make
```

There is a man page for it, which you may wish to read via:

```
	nroff -man < png-to-badge-asset.1 | more
```

It outputs C code to stdout, diagnostics to stderr.  For example:

```
$ ../../tools/png-to-badge-asset 8 badgey_assets/star.png
Processing badgey_assets/star.png
/* Begin code generated by png-to-badge-asset from badgey_assets/star.png Sat Apr 13 08:29:05 2024. */
static const uint16_t star_colormap[51] = {
	0x1081, 0x0000, 0xa4cd, 0x5286, 0x3143, 0x6b08, 0x2902, 0x0800, 0x39c4, 0x3184, 0x3984, 0x18c1,
	0x4204, 0x39c5, 0x5246, 0x62c7, 0x5ac7, 0x5a86, 0x7348, 0xa4cc, 0xa48c, 0x83c9, 0x2943, 0xc5ce,
	0xe690, 0xeed0, 0x83ca, 0x9c4b, 0xc58e, 0xde90, 0xe6d0, 0xf757, 0x944b, 0xeed1, 0xf711, 0xff57,
	0xad0e, 0x944c, 0x2102, 0x4a46, 0xde4f, 0x1881, 0x940a, 0x7b89, 0x5a87, 0x41c4, 0x6b07, 0x2903,
	0x4a05, 0x2942, 0x0840,
}; /* 51 values */

static const uint8_t star_data[256] = {
	0, 0, 1, 1, 1, 1, 1, 2, 3, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1,
	1, 1, 1, 2, 5, 1, 1, 1, 1, 1, 6, 7, 1, 0, 8, 1, 1, 1, 1, 9,
	2, 1, 1, 1, 1, 10, 11, 1, 1, 1, 12, 13, 1, 1, 1, 3, 2, 1, 1, 1,
	14, 8, 1, 1, 1, 1, 1, 15, 16, 1, 1, 2, 2, 1, 2, 2, 17, 1, 1, 1,
	1, 1, 1, 2, 2, 18, 2, 2, 19, 2, 20, 21, 1, 1, 1, 1, 1, 1, 1, 1,
	22, 23, 2, 24, 25, 23, 23, 1, 1, 1, 1, 1, 26, 2, 2, 27, 28, 29, 30, 31,
	31, 23, 23, 2, 2, 32, 2, 2, 2, 23, 2, 23, 23, 33, 34, 35, 31, 24, 2, 36,
	37, 2, 2, 5, 1, 38, 39, 2, 2, 2, 29, 25, 25, 40, 2, 17, 41, 10, 11, 1,
	1, 1, 1, 3, 3, 23, 2, 23, 40, 23, 23, 2, 1, 1, 1, 1, 1, 1, 1, 9,
	2, 16, 2, 2, 23, 42, 19, 5, 1, 1, 1, 1, 1, 1, 8, 43, 2, 44, 45, 2,
	2, 10, 8, 46, 1, 1, 1, 1, 1, 47, 48, 1, 1, 1, 1, 2, 39, 1, 1, 45,
	8, 1, 1, 1, 49, 4, 1, 1, 1, 1, 1, 2, 16, 1, 1, 1, 1, 1, 1, 1,
	50, 1, 1, 1, 1, 1, 1, 15, 2, 1, 1, 1, 1, 1, 1, 1,
}; /* 256 values */

static const struct asset2 star = {
	.type = PICTURE8BIT,
	.seqNum = 1,
	.x = 16,
	.y = 16,
	.colormap = (const uint16_t *) star_colormap,
	.pixel = (const unsigned char *) star_data,
};
/* End of code generated by png-to-badge-asset from badgey_assets/star.png Sat Apr 13 08:29:05 2024 */
Processed 1 file(s) with 0 error(s) and 0 warning(s).
```

You could redirect stdout to a file, or just grab the code with a mouse and paste
it into your program.  png-to-badge-asset is much simpler and easier to get working
than the older asset converter python program which requires specific versions of
python and fails in mysterious ways when you accidentally use the wrong version of
python.  Furthermore png-to-badge-asset compacts the data a bit better for use with
the newer "2" variants of the FbImage() functions.

By default the variables of type "struct asset2" in the code png-to-badge-asset
produces have static scope.  This may be suppressed with the '-s' or
'--nostatic' option.

# Old Asset Generator / Image Converter

"asset-converter.py"

This utility is a Python program that takes images in a folder and generates C structures that can be used
with the framebuffer functions to draw that image on the badge.

## Dependencies

You'll need Python. Additional dependencies can be installed by running `pip install -r requirements.txt` 
in this directory.

## What you'll need

You should have a folder that contains:

1) The images you want to convert in png, jpg, or bmp format (Others may work too).
2) an `images.yaml` with a list of the images to be converted. More details on that down the page.

It generates several things inside that folder:

1) a C file for each image. This C file contains the data structure for your converted image.
2) a single header file, containing extern declarations of the structures in your C files. You can include this
   inside your app, in order to reference your images.
3) a CMakeLists.txt file that adds your files to the build.

It is best to have a setup something like the following...

```
   source/apps/
               ...
               CMakeLists.txt
               ...
               myapp.h
               myapp.c
               myapp_images/
                            cool_picture.png
                            cool_picture_2.png
                            images.yaml
```

When you run the script:

```python tools/asset_converter.py source/apps/myapp_images/```

If everything succeeds, you should have some new files, in addition to the old ones:
```
   source/apps/myapp_images/
                            CMakeLists.txt
                            cool_pic.c
                            cool_pic_2.c
                            myapp_assets.h
```

You can modify the already-existing `source/apps/CMakeLists.txt` to add a line: `add_subdirectory(myapp_images)`. Now,
your images are added to the build! you can `#include "myapp_assets.h"` and start drawing them!

### `images.yaml`

(See feed-asset-converter, below)

Your `images.yaml` should have the following structure:

```yaml
name: myapp_assets
images:
  - name: "cool_pic"
    filename: "myapp_cool_picture.png"
    bits: 4
  - name: "cool_pic_2"
    filename: "myapp_cool_picture_2.png"
    bits: 8
```

The `name` at the top of the file will be name of the generated header (.h) file. Each image needs three fields:
* Another `name`, which will be the name of the (.c) file.
* The `filename` of the image to be converted
* The bit level to use. Valid values are 1, 2, 4, 8, and 16. The smaller the bit level, the smaller the images, so use
  the smallest one you can.
  * 1-bit images are "monochrome" images. You can specify the exact colors to use in the framebuffer code.
  * 2, 4, and 8 bit images are "palette" images. The converter will generate a palette of colors to use, and encode
    the images to use only those colors. The maximum number of colors used at the bit levels 4, 16, and 256 colors, 
    respectively. If your images have more than the maximum number of colors in them, the library used to the script 
    will figure out a good set of colors to use automatically.
  * 16-bit images are pure color images. (it stores the image in a raw, display-native format.)

### feed-asset-converter

The above YAML file is a pain in the ass to create.  feed-asset-converter can help you
create it from a directory of .png files.

```
    ./feed-asset-converter mypngdir myapp_assets [bits-per-pixel] > myfile.yaml
```

bits-per-pixel is by default, 8.

